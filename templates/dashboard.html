<script>
    // Auto-refresh every 5 minutes
    setTimeout(() => location.reload(), 5 * 60 * 1000);

    var map = L.map('map').setView([31.3, -94.7], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
    }).addTo(map);

    const greenIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    const redIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

{% for row in data %}
L.circleMarker([{{ row['Latitude'] }}, {{ row['Longitude'] }}], {
    color: '{{ "green" if row["StatusCode"] == 200 else "red" }}',
    radius: 8,
    fillOpacity: 0.8
}).addTo(map)
.bindPopup("<b>{{ row['Facility'] }}</b><br>Status: {{ row['Status'] }}<br><a href='{{ row['URL'] }}' target='_blank'>Visit</a>");
{% endfor %}

<script>
    setTimeout(() => {
        window.location.reload();
    }, 5 * 60 * 1000); // 5 minutes
</script>
